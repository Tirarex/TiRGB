
<html lang="en">
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="style.css">
		      <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Ti RGB</title>
            <script src="iro.min.js" charset="utf-8"></script>
        <script async type="text/javascript">
            var connection = new WebSocket('ws://192.168.31.62:81/');

            connection.onerror = function(error) {
                alert("ERROR " + error.message);
            };

            function SendVar(pref,val)
            {
                connection.send(pref+val);
            }	
            function SendPref(val)
            {
                connection.send(val);
            }

            function RgbGlob(vval)
            {
                SendVar('r',vval);
                SendVar('g',vval);
                SendVar('b',vval);
            }

            function hexToRgb(hex) {
                var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
                return result ? {
                    r: parseInt(result[1], 16),
                    g: parseInt(result[2], 16),
                    b: parseInt(result[3], 16)
                } : null;
            }			

            function sendColor(newValue)
            {
                // получаем RGB из HEX
                var RGBColor = hexToRgb(newValue); 
                //Отправляем данные на ESP
                if(RGBColor) {  
                    SendVar('r',(Math.round(RGBColor.r)));
                    SendVar('g',(Math.round(RGBColor.g)));
                    SendVar('b',(Math.round(RGBColor.b)));
                   
                    }
                
                
                
                
            
            
            
            }


            var colorp = new iro.ColorWheel("#IroJSWheel", { });
            colorp.watch(colorChangeHandler)

            function colorChangeHandler(color) {
                sendColor(color.hexString);
            }
        </script>
    </head>
    <body>
        <div class="stuff">
            <div class="panel">
                <h2>RGB Strip</h2>
                <div id="IroJSWheel"></div>

                <br>
                <p>
                    <button type="button" onclick="SendVar('m',1)" class="btn btn-primary ">
                        Rainbow
                    </button>
                    <input type="range"  value="0" min="1" max="2000" oninput="SendVar('t',this.value)"
                           step="5" data-highlight="true" />
                </p>
                <p>
                    <button type="button" onclick="RgbGlob(255)" class="btn btn-default " >
                        On
                    </button>
                    <button type="button" onclick="RgbGlob(0)" class="btn btn-default " >
                        Off
                    </button>
                </p>
                <p>
                    <button type="button"  onclick="location.href='/reboot'" class="btn " >
                        Reboot
                    </button>
                    <button type="button"  onclick="location.href='/upd'" class="btn" >
                        Update
                    </button>
                    <button type="button" onclick="location.href='/edit.htm'" class="btn" >
                        Editor
                    </button>
                </p>
            </div>
            <p>Made by: <a href="http://tiralab.xyz/" target="_blank">http://tiralab.xyz/</a></p>
            <p>Get it from: <a href="github.com/Tirarex/TiRGB" target="_blank">https://github.com/Tirarex/TiRGB/</a></p>
        </div>
    </body>
</html>